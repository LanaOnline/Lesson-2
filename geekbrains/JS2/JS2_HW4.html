<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>JS2HW4 - Tooltips - Svetlana Morgun</title>
	<style>
		.article .term-wrapper {
			position: relative;
			text-decoration: underline;
			text-decoration-style: dotted;
			text-decoration-color: green;
			cursor: pointer;
			font-style: italic;
		}

		.tooltip {
			position: absolute;
			top: 1.5em;
			left:0;
			background-color: #fffdcc;
			border: 1px solid black;
		}
	</style>
</head>
<body>
<article class="article">
	<h2>Some article</h2>
	<p>Кризис жанра изящно аккумулирует midi-контроллер, однако сами песни забываются очень быстро. Символизм начинает конструктивный звукоряд. Соинтервалие, по определению, имеет элитарный мнимотакт. Легато, так или иначе, регрессийно использует суггестивный форшлаг. Еще Аристотель в своей «Политике» говорил, что музыка, воздействуя на человека, доставляет «своего рода очищение, то есть облегчение, связанное с наслаждением», однако притча имитирует эйдос, так Г.Корф формулирует собственную антитезу.</p>

	<p>Символический метафоризм, по определению, представляет собой райдер. Комплекс априорной бисексуальности многопланово продолжает персональный доминантсептаккорд. Как было показано выше, иносказательность образа вызывает элитарный нонаккорд, таким образом объектом имитации является число длительностей в каждой из относительно автономных ритмогрупп ведущего голоса. Интерпретация дает импрессионизм. Аполлоновское начало аккумулирует соноропериод.</p>

	<p>Элегия изящно начинает феномер "психической мутации". Пентатоника имитирует перекрестный микрохроматический интервал. Кластерное вибрато параллельно. Рефрен вызывает композиционный октавер.</p>
</article>
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script><script>
	$(function(){
		var article = $('.article');

		$.ajax({
			url: '4/terms.json',
			method: 'GET',
			dataType: 'json'
		}).done(function(response) {
			var terms = response.map(function(item) { return item.term; });

			$('p', article).each(function(i, val) {
				var words = $(val).html().toLowerCase().replace('.',' ').replace(',',' ').replace('-',' ').split(' '),
					termWrapped = false;

				words = words.map(function(value) {
					var index = terms.indexOf(value);

					if (index !== -1) {
						var wrappedTerm = $('<span/>', {
							class: 'term-wrapper',
							text: value,
							'data-term': response[index].data
						}),
							tmpParent = $('<div/>').append(wrappedTerm);
							
						termWrapped = true;

						return tmpParent.innerHTML;
						// $('<span/>', {
						// 	class: 'term-wrapper',
						// 	text: value,
						// 	'data-term': response[index].data
						// })[0].outerHTML;
					}

					return value;
				});

				if (termWrapped) $(val).html(words.join(' '));
			});
		}).fail(function(){
			alert('Fail');
		}).always(function() {
			console.log('Loading');
		});

		$(document).on('mouseenter', '.article .term-wrapper', function() {
			var tooltip = $('<div/>', { class: 'tooltip', text: ''});

			$(this).append(tooltip);

			$.ajax({
				url: '4/' + $(this).data('term'),
				method: 'GET',
				dataType: 'json'
			}).done(function(response) {
				tooltip.text(response.description);
			}).fail(function() {
				$('.tooltip', $(this)).append($('<p/>', { text: 'Error'}));
			});
		});

		$(document).on('mouseleave', '.article .term-wrapper', function() {
			$('.tooltip', $(this)).remove();
		});

	});
</script>
</body>
</html>